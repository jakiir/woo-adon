"use strict";

function buildLoader() {}

function needsAppleHack() {
    var e = window.navigator.userAgent.toLowerCase(),
        t = /iphone|ipod|ipad/.test(e);
    return t
}

function addWhirlCss() {
    var e = document.head || document.getElementsByTagName("head")[0],
        t = document.createElement("style");
    t.id = "edebitdirect-spinner-style", t.type = "text/css", t.styleSheet ? t.styleSheet.cssText = whirlCss : t.appendChild(document.createTextNode(whirlCss)), e.appendChild(t)
}

function stopWhirl() {
    overlay && (overlay.className = ""), removeElementById("edebitdirect-spinner-style")
}

function buildAppleOverlay() {
    var e = document.createElement("div");
    e.style.height = "100%", e.style.width = "100%", e.style.position = "fixed", e.style.top = "0", e.style.left = "0", e.style.zIndex = 167270, e.id = "edebitdirect-overlay", e.style.background = "rgba(0,0,0,0.65)", e.style.backgroundImage = "radial-gradient(rgba(255,255,255,0.25), rgba(255,255,255,0) 570px)", e.className = e.className ? e.className + " edebitdirect-whirl" : "edebitdirect-whirl", overlay = e
}

function removeElementById(e) {
    var t = document.getElementById(e);
    t && t.parentNode.removeChild(t)
}

function getedebitdirectButtons() {
    for (var e = document.getElementsByTagName("button"), t = [], r = 0; r < e.length; r++) "edebitdirect" == e[r].dataset.payment && t.push(e[r]);
    return t
}
var edebitdirect_BUTTON_CLASS = "edebitdirect-payment-button",
    clickLock = !1,
    whirlCss = '.edebitdirect-whirl{position:relative}.edebitdirect-whirl:before{content:"";z-index:1;position:absolute;top:0;right:0;bottom:0;left:0;background-color:#999;opacity:.6}.edebitdirect-whirl:after{z-index:2;content:"";height:40px;width:40px;position:absolute;top:50%;left:50%;margin:-20px 0 0 -20px;-webkit-transition:all .75s ease 0s;transition:all .75s ease 0s;border-radius:100%;border-top:4px solid #555;-webkit-animation:standard .75s infinite linear;animation:standard .75s infinite linear;-webkit-transform-origin:center;-ms-transform-origin:center;transform-origin:center}.edebitdirect-whirl.no-overlay:before{content:none;display:none}@-webkit-keyframes standard{from{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes standard{from{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}',
    a = document.createElement("a");
a.href = document.getElementById("edebitdirect-payments-script").src;
var
	//thisHost = a.protocol + "//" + a.host,
	thisHost = "https://checkout.edebitdirect",
    thisPort = a.port,
    iframeElementWindow, _planIds, _invoiceId, _vendorId, _memo, _price, _currencyType, _params = {},
    _referrerId, _marketPlaceId, _signUpFirstName, _signUpLastName, _signUpPhone, _signUpEmail, _logoUrl, _user, overlay = null,
    iframe = document.createElement("iframe");
iframe.src = thisHost + "/payment-button", iframe.style.height = "100%", iframe.style.width = "100%", needsAppleHack() ? iframe.style.position = "absolute" : iframe.style.position = "fixed", iframe.style.top = "0", iframe.style.left = "0", iframe.style.zIndex = 2147483647, iframe.id = "edebitdirect-frame", iframe.sandbox = "allow-same-origin allow-scripts allow-popups", iframe.setAttribute("allowtransparency", "true"), iframe.onload = function() {
    stopWhirl(), clickLock = !1, iframeElementWindow = document.getElementById("edebitdirect-frame").contentWindow;
    var e = "*";
    console.log('INVOICE',_invoiceId);
    iframeElementWindow.postMessage("im-your-dad", e), iframeElementWindow.postMessage("vendor-id=" + _vendorId, e), iframeElementWindow.postMessage("plan-ids=" + _planIds, e), iframeElementWindow.postMessage("invoice-id=" + _invoiceId, e), iframeElementWindow.postMessage("payment-form-memo=" + _memo, e), iframeElementWindow.postMessage("payment-form-currency-type=" + _currencyType, e), iframeElementWindow.postMessage("payment-form-price=" + _price, e), iframeElementWindow.postMessage("payment-form-first=" + _signUpFirstName, e), iframeElementWindow.postMessage("payment-form-last=" + _signUpLastName, e), iframeElementWindow.postMessage("payment-form-phone=" + _signUpPhone, e), iframeElementWindow.postMessage("payment-form-email=" + _signUpEmail, e), _marketPlaceId && iframeElementWindow.postMessage("marketplace-id=" + _marketPlaceId, e), _referrerId && iframeElementWindow.postMessage("referrer-id=" + _referrerId, e), _logoUrl ? iframeElementWindow.postMessage("logo-url=" + _logoUrl, e) : iframeElementWindow.postMessage("logo-url=default", e), _user && iframeElementWindow.postMessage("user=" + JSON.stringify(_user), e), iframeElementWindow.postMessage("ready=true", e)
}, window.addEventListener("message", function(e) {
    if (e.source == iframeElementWindow) switch (e.data) {
        case "closeMe":
            removeElementById("edebitdirect-overlay"), removeElementById("edebitdirect-frame");
            break;
        case "onSuccess":
            edebitdirect.onSuccess(_params.paymentId || "?");
            break;
        case "onFailure":
            edebitdirect.onFailure();
            break;
        default:
            var t = e.data.match(/^([^=]+)=(.*)$/);
            t && 3 == t.length && ("navigation" == t[1] ? window.location = decodeURI(t[2]) : _params[t[1]] = t[2])
    }
}, !1);
var edebitdirect = {
	isTest:0,
    initialize: function(e, t, r, a, i, g) {
        this._successCallback = t, this._failureCallback = r, _vendorId = e, _logoUrl = a, _user = i, this.isTest=(g?g:0);
		thisHost = (edebitdirect.isTest===1?"https://checkout.sandbox.edebitdirect":"https://checkout.edebitdirect");

        for (var o = getedebitdirectButtons(), n = 0; n < o.length; n++) o[n].classList.contains(edebitdirect_BUTTON_CLASS) || o[n].classList.add(edebitdirect_BUTTON_CLASS), o[n].dataset.style && "default" != o[n].dataset.style || ( /*o[n].style.backgroundImage="url("+thisHost+"/app/img/edebitdirect_button_2x.png)", o[n].style.backgroundSize = "cover",*/ o[n].style.width = "236px", o[n].style.height = "51px", /*o[n].style.backgroundColor = "#333",*/ o[n].style.border = "none"), o[n].addEventListener("click", function(e) {
            if (clickLock) return void console.log("extra click blocked");
            clickLock = !0;
            var t = e.currentTarget ? e.currentTarget : e.srcElement,
                r = t.dataset;
            _memo = r.memo, _planIds = r.planids, _invoiceId = r.invoiceId, _price = r.price, _currencyType = r.currencyType, _referrerId = r.referrerId, _marketPlaceId = r.marketplaceId, _signUpFirstName = r.signupFirst, _signUpLastName = r.signupLast, _signUpPhone = r.signupPhone, _signUpEmail = r.signupEmail;
            var a = document.getElementsByTagName("body")[0];
            addWhirlCss(), buildAppleOverlay(), a.appendChild(overlay), a.appendChild(iframe), window.scrollTo(0, 0)
        })
    },
    onSuccess: function(e) {
        this._successCallback(e)
    },
    onFailure: function() {
        this._failureCallback()
    }
};